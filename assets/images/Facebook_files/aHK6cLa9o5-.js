;/*FB_PKG_DELIM*/

__d("EBMinosWasmDeriveMailboxAuthKeypair",["EBGetMinosWasm","EBMinosLogger","EBMinosTypes","EBMinosWasm.pb","WACreateWasmFunction","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=a.getWasmModule,c=d("EBMinosLogger").minosLogger.TAGS(["derive-mailbox-auth-key-pair"]);function e(a){var b=a.mailboxAuthPrivateKey;a=a.mailboxAuthPublicKey;return d("WAResultOrError").makeResult({pk:d("EBMinosTypes").unsafeCastToMailboxAuthPK(a),sk:d("EBMinosTypes").unsafeCastToMailboxAuthSK(b)})}return async function(a){var f=a.epochNumber;a=a.exportRootKey;var g=d("WACreateWasmFunction").createWasmFunction({InputSpec:d("EBMinosWasm.pb").DeriveMailboxAuthKeypairInputSpec,ResultSpec:d("EBMinosWasm.pb").DeriveMailboxAuthKeypairResultSpec,cli:"minos_cli",command:"derive-mailbox-auth-key-pair",getWasmModule:b,logger:c,validateResult:e});g=await g({epochNumber:f,exportRootKey:a});return g}}b=a({getWasmModule:d("EBGetMinosWasm").getMinosWasm});g.deriveMailboxAuthKeypair=b}),98);
__d("EBMinosWasmDeriveMailboxEncryptionKeypair",["EBGetMinosWasm","EBMinosLogger","EBMinosTypes","EBMinosWasm.pb","WACreateWasmFunction","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=a.getWasmModule,c=d("EBMinosLogger").minosLogger.TAGS(["derive-mailbox-encryption-key-pair"]);function e(a){var b=a.mailboxEncryptionPrivateKey;a=a.mailboxEncryptionPublicKey;return d("WAResultOrError").makeResult({pk:d("EBMinosTypes").unsafeCastToMailboxEncryptionPK(a),sk:d("EBMinosTypes").unsafeCastToMailboxEncryptionSK(b)})}return async function(a){var f=a.epochNumber;a=a.exportRootKey;var g=d("WACreateWasmFunction").createWasmFunction({InputSpec:d("EBMinosWasm.pb").DeriveMailboxEncryptionKeypairInputSpec,ResultSpec:d("EBMinosWasm.pb").DeriveMailboxEncryptionKeypairResultSpec,cli:"minos_cli",command:"derive-mailbox-encryption-key-pair",getWasmModule:b,logger:c,validateResult:e});g=await g({epochNumber:f,exportRootKey:a});return g}}b=a({getWasmModule:d("EBGetMinosWasm").getMinosWasm});g.deriveMailboxEncryptionKeypair=b}),98);
__d("EBMinosWasmDeriveMailboxSigningKeypair",["EBGetMinosWasm","EBMinosLogger","EBMinosTypes","EBMinosWasm.pb","WACreateWasmFunction","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=a.getWasmModule,c=d("EBMinosLogger").minosLogger.TAGS(["derive-mailbox-signing-key-pair"]);function e(a){var b=a.mailboxSigningPrivateKey;a=a.mailboxSigningPublicKey;return d("WAResultOrError").makeResult({pk:d("EBMinosTypes").unsafeCastToMailboxSigningPK(a),sk:d("EBMinosTypes").unsafeCastToMailboxSigningSK(b)})}return async function(a){var f=a.epochNumber;a=a.exportRootKey;var g=d("WACreateWasmFunction").createWasmFunction({InputSpec:d("EBMinosWasm.pb").DeriveMailboxSigningKeypairInputSpec,ResultSpec:d("EBMinosWasm.pb").DeriveMailboxSigningKeypairResultSpec,cli:"minos_cli",command:"derive-mailbox-signing-key-pair",getWasmModule:b,logger:c,validateResult:e});g=await g({epochNumber:f,exportRootKey:a});return g}}b=a({getWasmModule:d("EBGetMinosWasm").getMinosWasm});g.deriveMailboxSigningKeypair=b}),98);
__d("EBMinosWasmWrapTransportSigningPublicKey",["EBGetMinosWasm","EBMinosLogger","EBMinosTypes","EBMinosWasm.pb","WACreateWasmFunction","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=a.getWasmModule,c=d("EBMinosLogger").minosLogger.TAGS(["wrap-transport-signing-public-key"]);function e(a){a=a.prefixedKey;return d("WAResultOrError").makeResult(d("EBMinosTypes").unsafeCastToTransportSigningPK(a))}return async function(a){a=a.signalIdentityPublicKey;var f=d("WACreateWasmFunction").createWasmFunction({InputSpec:d("EBMinosWasm.pb").WrapTransportSigningPublicKeyInputSpec,ResultSpec:d("EBMinosWasm.pb").WrapTransportSigningPublicKeyResultSpec,cli:"minos_cli",command:"wrap-transport-signing-public-key",getWasmModule:b,logger:c,validateResult:e});f=await f({keyBytes:a});return f}}b=a({getWasmModule:d("EBGetMinosWasm").getMinosWasm});g.wrapTransportSigningPublicKey=b}),98);
__d("EBMinosWasmWrapTransportSigningSecretKey",["EBGetMinosWasm","EBMinosLogger","EBMinosTypes","EBMinosWasm.pb","WACreateWasmFunction","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=a.getWasmModule,c=d("EBMinosLogger").minosLogger.TAGS(["wrap-transport-signing-secret-key"]);function e(a){a=a.prefixedKey;return d("WAResultOrError").makeResult(d("EBMinosTypes").unsafeCastToTransportSigningSK(a))}return async function(a){a=a.signalIdentityPrivateKey;var f=d("WACreateWasmFunction").createWasmFunction({InputSpec:d("EBMinosWasm.pb").WrapTransportSigningSecretKeyInputSpec,ResultSpec:d("EBMinosWasm.pb").WrapTransportSigningSecretKeyResultSpec,cli:"minos_cli",command:"wrap-transport-signing-secret-key",getWasmModule:b,logger:c,validateResult:e});f=await f({keyBytes:a});return f}}b=a({getWasmModule:d("EBGetMinosWasm").getMinosWasm});g.wrapTransportSigningSecretKey=b}),98);
__d("EBMinosWrapTransportSigningKeypair",["EBMinosLogger","EBMinosWasmWrapTransportSigningPublicKey","EBMinosWasmWrapTransportSigningSecretKey","WAByteArray","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to wrap transport signing secret key"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to wrap transport signing public key"]);i=function(){return a};return a}async function a(a){var b=a.privateKey;a=a.publicKey;a=d("EBMinosWasmWrapTransportSigningPublicKey").wrapTransportSigningPublicKey({signalIdentityPublicKey:d("WAByteArray").uint8ArrayToBuffer(a)});b=d("EBMinosWasmWrapTransportSigningSecretKey").wrapTransportSigningSecretKey({signalIdentityPrivateKey:d("WAByteArray").uint8ArrayToBuffer(b)});a=await Promise.all([a,b]);b=a[0];a=a[1];if(!b.success){d("EBMinosLogger").minosLogger.ERROR(i());return d("WAResultOrError").makeError("minos-wrap-transport-signing-keypair-error")}if(!a.success){d("EBMinosLogger").minosLogger.ERROR(h());return d("WAResultOrError").makeError("minos-wrap-transport-signing-keypair-error")}b={pk:b.value,sk:a.value};return d("WAResultOrError").makeResult(b)}g.wrapTransportSigningKeypair=a}),98);
__d("EBSenderUploadQueue",["EBMinosLogger","PersistedQueueApi","WAPersistedQueue"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to write to ebSenderUploadQueue ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["EB Upload Queue is already initialized"]);i=function(){return a};return a}b=function(a){return a};var j=null;function k(){return j==null?l():j}function l(){j!=null&&d("EBMinosLogger").minosLogger.ERROR(i());var a=d("WAPersistedQueue").initPersistedQueue("ebSenderUploadQueue",d("PersistedQueueApi").persistedQueueApi());j=a;return a}async function a(a){if(a.length===0)return Promise.resolve();try{var b=k();await b.addAndCommit(a)}catch(a){d("EBMinosLogger").minosLogger.ERROR(h(),a);return Promise.reject(a)}}g.toSendersQueueId=b;g.ebSenderUploadQueue=k;g.enqueueMessages=a}),98);
__d("EBMinosFakeData",["EBMinosLogger","EBMinosTypes","EBMinosWasmDeriveMailboxAuthKeypair","EBMinosWasmDeriveMailboxEncryptionKeypair","EBMinosWasmDeriveMailboxSigningKeypair","EBMinosWrapTransportSigningKeypair","EBSenderUploadQueue","MpsTypes","WABase64","WAStanzaUtils","err"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to generate fake minos data: ",""]);h=function(){return a};return a}e=[new Uint8Array([1,2,3]).buffer,new Uint8Array([4,5,6]).buffer].map((b=d("EBMinosTypes")).unsafeCastToEpochHead);f={actionType:1,originalMsgProtocolId:{externalId:d("WAStanzaUtils").toStanzaId("123")},supplementalKey:"456"};var i=new TextEncoder().encode("This is a test message"),j=b.unsafeCastToExportRootKey(new TextEncoder().encode("fake_epoch_root_with_32_bytes_01").buffer),k=b.unsafeCastToExportRootKey(new TextEncoder().encode("fake_epoch_root_with_32_bytes_02").buffer),l=b.unsafeCastToEpochNumber(1),m=b.unsafeCastToEpochNumber(1),n=b.unsafeCastToEpochHead(new TextEncoder().encode("fake_epoch_head_with_32_bytes_01").buffer),o=new Date("2025-04-15 14:30:00"),p={privateKey:new Uint8Array(new Array(32).fill(0)),publicKey:new Uint8Array(new Array(32).fill(0))},q;function a(){if(q==null){var a=r().catch(function(a){d("EBMinosLogger").minosLogger.ERROR(h(),a);throw a});q=a;return q}return q}async function r(){var a=await d("EBMinosWasmDeriveMailboxAuthKeypair").deriveMailboxAuthKeypair({epochNumber:l,exportRootKey:j});if(!a.success)throw c("err")("Failed to generate mailbox signing key pair");var b=await d("EBMinosWasmDeriveMailboxSigningKeypair").deriveMailboxSigningKeypair({epochNumber:l,exportRootKey:j});if(!b.success)throw c("err")("Failed to generate mailbox signing key pair");var e=await d("EBMinosWasmDeriveMailboxEncryptionKeypair").deriveMailboxEncryptionKeypair({epochNumber:l,exportRootKey:j});if(!e.success)throw c("err")("Failed to generate mailbox signing key pair");e=await d("EBMinosWasmDeriveMailboxEncryptionKeypair").deriveMailboxEncryptionKeypair({epochNumber:m,exportRootKey:k});if(!e.success)throw c("err")("Failed to generate mailbox signing key pair");var f=d("EBMinosTypes").unsafeCastMekRosterHash(d("WABase64").decodeB64("ozgiys3XbaFsaiWBfiB04j+YsxqCYC0M+PKg2O460kA=")),g=await d("EBMinosWrapTransportSigningKeypair").wrapTransportSigningKeypair(p);if(!g.success)throw c("err")("Failed to generate transport signing key pair");var h=d("EBMinosTypes").unsafeCastToEpochFbId("1234");return{epochFbId:h,fakeMekRosterHash:f,fakeMessage:i,recipientEncryptionKeyPair:e.value,recipientEpochHead:n,recipientEpochHeadCreationTime:o,recipientEpochNumber:m,recipientMailboxKeyFbId:d("EBMinosTypes").unsafeCastToMailboxFbId(123),recipientUserFbId:d("EBMinosTypes").unsafeCastToUserFbId("123456"),senderAuthKeypair:a.value,senderEpochHead:n,senderEpochNumber:l,senderSigningKeypair:b.value,transportSenderKeypair:g.value}}f={deletionOfflineThreadingId:void 0,directive:f,epochHeads:[n],messageId:d("MpsTypes").toMessageId("143222"),payload:new Uint8Array(0).buffer,queueId:d("EBSenderUploadQueue").toSendersQueueId(123),senderId:"59668010114073@msgr",supplementalOpToken:void 0,tags:[],threadId:d("MpsTypes").toThreadId("59668010114073@msgr"),timestampMs:41};b=b.unsafeCastToTransportSigningPK(new Uint8Array([42,85,123,56,78,90,34,67,89,12,45,67,23,56,78,90,11,22,33,44,55,66,77,88,99,100,101,102,103,104,105,106,107]).buffer);g.FAKE_EPOCH_HEADS=e;g.getFakeMinosData=a;g.FAKE_UPLOAD_ENTITY=f;g.FAKE_TRANSPORT_SIGNING_PUBLIC_KEY=b}),98);
__d("EBGetMessageKeys",["EBMinosFakeData","FBLogger","MAWMpsGating","WAResultOrError","WebMps","getErrorSafe"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Runtime error in EBGetMessageKeys"]);h=function(){return a};return a}async function a(a){var b=a.messageId;a=a.threadId;try{if(b==null||a==null)return d("WAResultOrError").makeError("invalid-arguments");if(!d("MAWMpsGating").isMpsM3OrLater())return d("WAResultOrError").makeError("not-supported");b=await d("WebMps").mps().loadMessage({config:{shouldFetchSupplementals:!0,strategy:"local-only"},debug:{purpose:"get-message-keys"},messageId:b,threadId:a});if(b.success===!1)return d("WAResultOrError").makeError(b.error);a=b.value;if(a==null)return d("WAResultOrError").makeError("no-message");var e=new Map();a.supplementalProtobufs.forEach(function(a,b){e.set(b,babelHelpers.extends({},a,{transportMessageSignature:d("EBMinosFakeData").FAKE_TRANSPORT_SIGNING_PUBLIC_KEY}))});b=babelHelpers.extends({},a.toplevelProtobuf,{transportMessageSignature:d("EBMinosFakeData").FAKE_TRANSPORT_SIGNING_PUBLIC_KEY});return d("WAResultOrError").makeResult(babelHelpers.extends({},a,{supplementalProtobufs:e,toplevelProtobuf:b}))}catch(a){c("FBLogger")("wmi_minos").catching(c("getErrorSafe")(a)).MUSTFIX(h());throw a}}g.getMessageKeys=a}),98);
__d("registerExecutionContext",["BroadcastChannelClientServerHandshake","FBLogger","getBroadcastChannelForExecutionContext","loadTaskHandlerResource","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";async function h(a,b){var d=a.context,e=a.name,f=a.payload;try{var g=await c("loadTaskHandlerResource")(e);if(g==null)throw c("FBLogger")("messenger_web").mustfixThrow("No task handler found in context %s",e);e=await g.handleTask(f,d);g={context:d,result:e,type:"task_success"};b.postMessage(g)}catch(g){c("FBLogger")("messenger_web").catching(g).mustfix("%s executionContext: Failed to execute task %s",String(a.context.executionContext),a.name);e={context:d,reason:(f=g.message)!=null?f:"",type:"task_failure"};b.postMessage(e)}return}function a(a){var b=c("getBroadcastChannelForExecutionContext")(a);d("BroadcastChannelClientServerHandshake").listen(b);var e=new Set();b.addEventListener("message",function(a){switch(a.data.type){case"execute_task":a=a.data;var d=a.context.taskID;if(e.has(d))return;e.add(d);c("promiseDone")(h(a,b).finally(function(){e.delete(d)}));break;default:}});return function(){return b.close()}}g.default=a}),98);